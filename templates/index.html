<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Spectrum</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        /* You can add custom styles here */
    </style>

</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">AI Spectrum</h1>

        <!-- Voice Call Section -->
        <div class="card">
            <div class="card-header">
                Voice Call 
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">Phone Number:</label>
                    <input type="text" class="form-control" id="phoneNumber" placeholder="e.g., +1234567890">
                </div>
                <div class="call-buttons">
                    <button id="startCallBtn" class="btn btn-primary">Start Call</button>
                    
                </div>
                <div id="callStatus" class="mt-3"></div>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="card mt-4">
            <div class="card-header">
                Chat (Text & Voice)
            </div>
            <div class="card-body">
                <div id="chatConversation" class="chat-container">
                    <div class="message ai-message">Hello! How can I assist you today?</div>
                </div>
                <div class="mb-3">
                    <label for="chatInput" class="form-label">Your Message:</label>
                    <div class="chat-input-group">
                        <textarea class="form-control" id="chatInput" rows="3" placeholder="Type or speak your message here..."></textarea>
                        <button id="voiceInputBtn" class="btn btn-outline-secondary" title="Start Voice Input">
                            <i class="bi bi-mic-fill"></i> 
                        </button>
                    </div>
                    <div id="listeningStatus" class="form-text"></div>
                </div>
                <div class="mb-3">
                    <label for="languageSelect" class="form-label">Target Language:</label>
                    <select class="form-select" id="languageSelect">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="hi">Hindi</option>
                        <option value="kn">Kannada</option>
                    </select>
                </div>
                <button id="sendChatBtn" class="btn btn-success">Send Message</button>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <script>
        // Handle Start Call Button
        document.getElementById("startCallBtn").addEventListener("click", function() {
            const phoneNumber = document.getElementById("phoneNumber").value;

            if (!phoneNumber) {
                alert("Please enter a phone number.");
                return;
            }

            fetch("/start_call", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ phone_number: phoneNumber })
            })
            .then(response => response.json())
            .then(data => {
                if (data.call_id) {
                    document.getElementById("callStatus").innerHTML = "Call started successfully! Call ID: " + data.call_id;
                    document.getElementById("startCallBtn").disabled = true;
                    document.getElementById("endCallBtn").disabled = false;
                } else {
                    document.getElementById("callStatus").innerHTML = "Error starting the call.";
                }
            })
            .catch(error => {
                document.getElementById("callStatus").innerHTML = "Failed to start the call.";
            });
        });

        // Handle End Call Button
        document.getElementById("endCallBtn").addEventListener("click", function() {
            fetch("/end_call", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ call_id: "call_id_here" })  // Replace with actual call ID from backend
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById("callStatus").innerHTML = "Call ended successfully.";
                    document.getElementById("startCallBtn").disabled = false;
                    document.getElementById("endCallBtn").disabled = true;
                }
            });
        });

        // Handle sending chat message
        // Handle sending chat message with audio response
document.getElementById("sendChatBtn").addEventListener("click", function() {
    const message = document.getElementById("chatInput").value;
    const language = document.getElementById("languageSelect").value;

    fetch("/send_message", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ message: message, language: language })
    })
    .then(response => response.json())
    .then(data => {
        if (data.reply) {
            const chatConversation = document.getElementById("chatConversation");
            const aiMessage = document.createElement("div");
            aiMessage.classList.add("message", "ai-message");
            aiMessage.textContent = data.reply;
            chatConversation.appendChild(aiMessage);
            
            // Assuming the backend is generating the audio response as well
            if (data.audio_url) {
                const audio = new Audio(data.audio_url);
                audio.play();  // Plays the audio response
            }
        }
    })
    .catch(error => {
        alert("Failed to send message.");
    });
});


    </script>
</body>
</html>
